{% extends "wx/base.html" %}
{% load static %}
{% load jsonify %}


{% block page_content %}

<script type="text/javascript">

    ln.history_handle({
        init:{crt_view:'main'},
        handler:function(state){
            if(state.crt_view) {
                table.crt_view = state.crt_view
            }
        }
    })


    $(function(){

        crt_view = 'main'

        table= new Vue({
            el:'#there',
            data:{
//                    menu:menu,
//                    rows:rows,
                crt_view:crt_view,
                ln:ln,
            },
            mixins:[table_fun],
            mounted:function(){

            },
            methods:{
                goto:function(url){
                    location=url
                },
                ge_edit:function(pk){
                    location= ex.template('{engine_url}/{page_name}.edit?pk={pk}',{engine_url:engine_url,page_name:page_name,pk:pk})
                },
                switch_to:function(name){
                    history.pushState({view:name},'',ex.appendSearch({crt_view:name}))
                    this.crt_view=name
                },
                back:function(){
                    history.back()
                },

                head_img:function(row){
                    return row.desp_img || row.work_desp_img
                }
            }
        })
    })
</script>




<div id="there" v-cloak>

    <div>

        <div class="flex">
            <div class="flex-grow"></div>
            <div style="text-align: right;padding: 0.5em 1em;">
                <i class="fa fa-align-justify fa-2x" aria-hidden="true" @click="show_menu=true"></i>
            </div>
        </div>

        <div class="weui-cells__title">列表项</div>
        <div v-for="row in rows">
            <img :src="head_img(row)" alt="">
        </div>

    </div>



    <transition name="slide">
        <div v-show="crt_view=='search'" class="slide-win">

            <com-filter :row_filters="row_filters" :search_args="search_args" :search_tip='search_tip'></com-filter>

            <div class="weui-btn-area">
                <a class="weui-btn weui-btn_primary" href="javascript:" @click='search()' style="width: 50%;">
                    <i class="fa fa-search" aria-hidden="true"></i>
                </a>
            </div>

        </div>
    </transition>
    <modal v-show="show_menu" @click.native="show_menu=false">
        <div class="weui-actionsheet__menu" @click.stop="" style="width: 80vw;">

            <div class="weui-actionsheet__cell" @click="add_new();show_menu=false" v-if="can_add">新建</div>
            <div class="weui-actionsheet__cell" @click="del_item();show_menu=false" v-if="can_del &&selected.length>0">删除选中</div>
            <div class="weui-actionsheet__cell" @click="ln.pushState({crt_view:'search'});show_menu=false" v-if="can_search">排序过滤</div>
        </div>
        <div class="weui-actionsheet__cell">
            <div class="weui-actionsheet__cell" @click="show_menu=false">取消</div>
        </div>
    </modal>

</div>

<style type="text/css">

</style>

{% endblock %}