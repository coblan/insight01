{% extends "wx/base.html" %}
{% load static %}
{% load jsonify %}


{% block page_content %}
<!--<script src="http://192.168.1.101:9999/target/target-script-min.js#anonymous"></script>-->

<!--<script src="{% static 'js/fields_mb.pack.js' %}"></script>-->
<script type="text/javascript">

    no_emp = {{ no_emp | jsonify | default:'false' }}
    username='{{ user.username }}'
    base_heads={{ base_heads | jsonify | default:'[]' }}
    base_row={{ base_row | jsonify | default:'{}' }}

    chg = '{% url 'change_password' %}'
    logout_url='{% url "logout" %}'
    uid={{ user.id }}

//    ex.each(base_heads,function(head){
//        head.placeholder='请输入'+
//    })

    $(function(){
        new Vue({
            el:'#there',
            data:{
                no_emp:no_emp,
                username:username,
                base_kw:{
                    heads:base_heads,
                    row:base_row,
                },

            },
//            mixins:[field_fun],
            computed:{
                chg_url:function(){
                    return ex.appendSearch(chg,{uid:uid,next:encodeURIComponent(location.href)})
                },
                logout_url:function(){
                    return ex.appendSearch(logout_url,{next:encodeURIComponent(location.href)})
                },
            },
            mounted:function(){

            },
            methods:{
                submit:function(){
                    var post_data=[{fun:'save_self_info','base_info':this.base_kw.row}]
                    ex.post("{% url 'ajax_url' app='employee' %}",JSON.stringify(post_data),function(resp){
//                        alert(resp)
                        if(!resp.save_self_info.msg){
                            weui.toast('操作成功', 3000);
                        }
                    })
                }
            }
        })
    })
</script>

<div id="there" v-cloak>


    <div v-if="no_emp">
        <h1>
            你还不是员工，请告知管理员你申请的账号，等待转换为员工账号。
        </h1>
    </div>


    <div class="weui-cells__title">账号信息</div>
    <div class="weui-cells">


        <div class="weui-cell">
            <div class="weui-cell__hd">
                <span style="padding-right: 20px;">您的账号是</span>
            </div>
            <div class="weui-cell__bd">
                <span v-text="username" ></span>

            </div>
            <div class="weui-cell__ft">
                <a :href="logout_url" style="padding-left: 40px;padding-right: 20px;">退出登录</a>
                <a :href="chg_url" style="padding-right: 20px;">修改密码</a>
            </div>
        </div>
    </div>

    <div v-if="!no_emp">
        <div class="weui-cells__title">个人信息</div>
        <!--<el-form  label-width="80px" class="el-form-pad">-->
        <div class="form-pad">
            <field v-for="head in base_kw.heads" :name="head.name" :kw="base_kw"></field>
        </div>

        <!--</el-form>-->



        <div class="weui-btn-area">
            <a class="weui-btn weui-btn_primary" href="javascript:" id="showTooltips" @click="submit()" style="width: 50vw;">保存修改</a>
        </div>
    </div>




</div>

<style type="text/css">

</style>

{% endblock %}

{% block main_menu %}

<div class="weui-tabbar nav footer">
    <a href="/wx/help.wx" class="weui-tabbar__item ">
        <i class="fa fa-info-circle weui-tabbar__icon" aria-hidden="true" ></i>
        <p class="weui-tabbar__label">信息</p>
    </a>
    <a href="/wx/home.wx" class="weui-tabbar__item ">
        <i class="fa fa-th weui-tabbar__icon" aria-hidden="true"></i>
        <p class="weui-tabbar__label">控制台</p>
    </a>
    <a href="/my_info" class="weui-tabbar__item weui-bar__item_on">
        <i class="fa fa-user-circle weui-tabbar__icon" aria-hidden="true" ></i>
        <p class="weui-tabbar__label">个人中心</p>
    </a>
</div>
{% endblock %}